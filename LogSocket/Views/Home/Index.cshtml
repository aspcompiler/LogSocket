@{
    ViewBag.Title = "Home Page";
}
@model System.Collections.Generic.HashSet<string>
<div class="jumbotron">
    <h1>Log Socket</h1>
</div>

<div class="row">
    <div class="col-md-2">
        <h2>Streams</h2>
        <div id="streams">
            <ul>
                @foreach (var s in Model)
                {
                    <li><a href="#" class="stream">@s</a></li>
                }
            </ul>
        </div>
    </div>
    <div class="col-md-10">
        <div id="logs" style="max-height:400px;min-height:400px;overflow-y:scroll;">

        </div>
    </div>
</div>

@section Scripts {

<!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.2.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var socket = $.connection.socket;
            // Create a function that the hub can call to broadcast messages.
            socket.client.addMessage = function (message) {
                // Html encode message.
                var encodedMsg = $('<div />').text(message)[0];
                // Add the message to the page.
                $('#logs').append(encodedMsg);
                var objDiv = document.getElementById("logs");
                objDiv.scrollTop = objDiv.scrollHeight;
            };
            var stream;
            // Start the connection.
            $.connection.hub.start().done(function () {
                $(".stream").click(function () {
                    //socket.server.subscribe('myStream');
                    if (stream) {
                        socket.server.unsubscribe(stream);
                        $('#logs').text("");
                    }
                    stream = $(this).text();
                    socket.server.subscribe(stream);
                });
            });
        });
</script>

}